{% capture tocWorkspace %}
    {% comment %}
        Based on allejo's jekyll-toc https://github.com/allejo/jekyll-toc
        
        Parameters:
            html         (string) - the HTML of compiled markdown generated by kramdown
            sanitize     (bool)   - when set to true, the headers will be stripped of any HTML in the TOC
            h_min        (int)    - the minimum TOC header level to use; default: 2
            h_max        (int)    - the maximum TOC header level to use; default: 6
            ordered      (bool)   - when set to true, an ordered list will be outputted instead of an unordered list
            skip_no_ids  (bool)   - skip headers that do not have an `id` attribute
    {% endcomment %}

    {% assign minHeader = include.h_min | default: 2 %}
    {% assign maxHeader = include.h_max | default: 6 %}
    {% assign nodes = include.html | split: '<h' %}
    
    {% assign firstHeader = true %}
    {% assign previousLevel = 0 %}
    
    {% capture listModifier %}{% if include.ordered %}ol{% else %}ul{% endif %}{% endcapture %}
    
    {% for node in nodes %}
        {% if node == "" %}
            {% continue %}
        {% endif %}
        
        {% assign headerLevel = node | replace: '"', '' | slice: 0, 1 | times: 1 %}
        
        {% if headerLevel < minHeader or headerLevel > maxHeader %}
            {% continue %}
        {% endif %}
        
        {% assign _idWorkspace = node | split: 'id="' %}
        {% assign _idWorkspace = _idWorkspace[1] | split: '"' %}
        {% assign nodeID = _idWorkspace[0] %}
        
        {% if include.skip_no_ids == true and nodeID == "" %}
            {% continue %}
        {% endif %}
        
        {% capture _hAttrToStrip %}{{ node | split: '>' | first }}>{% endcapture %}
        {% assign header = node | remove: _hAttrToStrip %}
        {% assign header = header | split: '</h' | first %}
        
        {% if include.sanitize == true %}
            {% assign header = header | strip_html %}
        {% endif %}
        
        {% if firstHeader %}
            {% assign firstHeader = false %}
            {% assign previousLevel = headerLevel %}
            
            {% unless headerLevel == minHeader %}
                {% for i in (minHeader..headerLevel) %}
                    {% if i == minHeader %}
                        <{{ listModifier }} id="markdown-toc">
                    {% else %}
                        <{{ listModifier }}>
                    {% endif %}
                {% endfor %}
            {% else %}
                <{{ listModifier }} id="markdown-toc">
            {% endunless %}
        {% endif %}
        
        {% if headerLevel > previousLevel %}
            {% for i in (1..headerLevel) %}
                {% if i > previousLevel %}
                    {% if i > minHeader %}
                        <{{ listModifier }}>
                    {% endif %}
                {% endif %}
            {% endfor %}
        {% elsif headerLevel < previousLevel %}
            {% assign repeatCount = previousLevel | minus: headerLevel %}
            
            {% for i in (1..repeatCount) %}
                {% if previousLevel > minHeader %}
                    </li></{{ listModifier }}>
                {% else %}
                    </li>
                {% endif %}
                {% assign previousLevel = previousLevel | minus: 1 %}
            {% endfor %}
            
            </li>
        {% else %}
            </li>
        {% endif %}
        
        <li><a href="#{{ nodeID }}">{{ header }}</a>
        {% assign previousLevel = headerLevel %}
    {% endfor %}
    
    {% if previousLevel >= minHeader %}
        {% for i in (minHeader..previousLevel) %}
            {% if i > minHeader %}
                </li></{{ listModifier }}>
            {% else %}
                </li></{{ listModifier }}>
            {% endif %}
        {% endfor %}
    {% endif %}
{% endcapture %}{% assign tocWorkspace = tocWorkspace | strip_newlines | strip %}{{ tocWorkspace }}